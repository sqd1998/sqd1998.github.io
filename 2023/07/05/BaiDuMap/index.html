<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********  Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<!--<![endif]-->

<head>
  <title>Vue项目引用百度地图并实现搜索定位等功能 | SQD_BLOG</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="SQD_BLOG">
    <meta name="author" content="SQD">
    <meta name="description" content="一个轻量级的博客网站" />
    <meta name="keywords" content="博客" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="SQD_BLOG" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
    
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    

    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->

  
  
  

  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="/" target="_BLANK" class="animsition-link">XXX1</a></li>
                    
                        <li><a href="/" target="_BLANK" class="animsition-link">XXX2</a></li>
                    
                </ul>
            </li>
            
            
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a target="_blank" rel="noopener" href="http://go.kieran.top/" class="animsition-link">Kieran</a></li>
                    
                    <li><a target="_blank" rel="noopener" href="http://domain.com/" class="animsition-link">Name</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">SQD_BLOG</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a></li>
                            
                            
                            <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a></li>
                            
                            
                            <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a></li>
                            
                            
                            <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a></li>
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2023-07-05T05:49:40.000Z" itemprop="datePublished">
          2023-07-05
      </time>
    
</span>
                <h1>Vue项目引用百度地图并实现搜索定位等功能</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<p><strong>前言</strong>：<a target="_blank" rel="noopener" href="http://lbsyun.baidu.com/">百度地图开放平台</a> 给开发者们提供了丰富的地图功能与服务，使我们的项目中可以轻松地实现地图定位、地址搜索、路线导航等功能。本文给大家介绍如何在vue项目中引用百度地图，并设计实现简单的地图定位、地址搜索功能。</p>
<p>功能点：</p>
<ol>
<li>挂载百度地图</li>
<li>封装逆地址解析函数（根据坐标点获取详细地址）</li>
<li>设置图像标注并绑定拖拽标注结束后事件</li>
<li>添加（右上角）平移缩放控件</li>
<li>添加（左下角）定位控件</li>
<li>浏览器定位（定位当前地点）</li>
<li>绑定点击地图任意点事件</li>
<li>结合element-ui实现输入提示选取地址并定位功能</li>
</ol>
<h4 id="二、前期准备"><a href="#二、前期准备" class="headerlink" title="二、前期准备"></a>二、前期准备</h4><p>在正式开发之前，我们先做好以下准备：</p>
<ul>
<li>在你的vue项目中引入element-ui （引入方法 <a target="_blank" rel="noopener" href="https://element.eleme.cn/#/zh-CN/component/quickstart">戳这</a>）<br>说明：本案例是结合element-ui进行开发，主要是为方便实现上面第8点功能，大家若是引入其他UI框架也可以，功能实现方法参照本案例自行修改即可。</li>
<li>申请百度地图AK<br>前往 <a target="_blank" rel="noopener" href="http://lbsyun.baidu.com/apiconsole/center#/home">百度地图开放平台控制台</a> ，登录百度账号，创建应用即得。<img src="https://img-blog.csdnimg.cn/2019121617351640.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01hcmNvX2h1aQ==,size_16,color_FFFFFF,t_70" alt="申请百度地图AK"></li>
</ul>
<h4 id="三、引入百度地图"><a href="#三、引入百度地图" class="headerlink" title="三、引入百度地图"></a>三、引入百度地图</h4><p>下面介绍如何在vue项目中引入百度地图<br><strong>方法一</strong><br>第1步：在 <strong>index.html</strong> 中引入下面代码，注意将你的AK代入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;http://api.map.baidu.com/api?v=3.0&amp;ak=您的密钥&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>第2步：在 <strong>webpack.base.conf.js</strong> 添加externals.BMap配置，与entry平级，内容如下，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">entry: &#123;</span><br><span class="line">  app: [&#x27;babel-polyfill&#x27;, &#x27;./src/main.js&#x27;]</span><br><span class="line">&#125;,</span><br><span class="line">externals: &#123;</span><br><span class="line">  BMap: &#x27;BMap&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第3步：在组件中引入BMap</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import BMap from &#x27;BMap&#x27;</span><br></pre></td></tr></table></figure>

<p><strong>方法二</strong><br>我们知道，vue-cli 3.0+ 的版本已经取消了webpack.conf这些文件了，所以上面的方法就不适用了。而且，方法一在index.html中全局引入百度api，有点耗性能。更多时候我们只希望在单个组件里按需引入即可，所以下面介绍的是以封装的方法引入。<br>第1步：在你的项目js资源文件夹下新建loadBMap.js文件，内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 动态加载百度地图api函数</span><br><span class="line"> * @param &#123;String&#125; ak  百度地图AK，必传</span><br><span class="line"> */</span><br><span class="line">export default function loadBMap(ak) &#123;</span><br><span class="line">  return new Promise(function(resolve, reject) &#123;</span><br><span class="line">    if (typeof window.BMap !== &#x27;undefined&#x27;) &#123;</span><br><span class="line">      resolve(window.BMap)</span><br><span class="line">      return true</span><br><span class="line">    &#125;</span><br><span class="line">    window.onBMapCallback = function() &#123;</span><br><span class="line">      resolve(window.BMap)</span><br><span class="line">    &#125;</span><br><span class="line">    let script = document.createElement(&#x27;script&#x27;)</span><br><span class="line">    script.type = &#x27;text/javascript&#x27;</span><br><span class="line">    script.src =</span><br><span class="line">      &#x27;http://api.map.baidu.com/api?v=3.0&amp;ak=&#x27; + ak + &#x27;&amp;callback=onBMapCallback&#x27;</span><br><span class="line">    script.onerror = reject</span><br><span class="line">    document.head.appendChild(script)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第2步：在组件中引入loadBMap函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import loadBMap from &#x27;@/&lt;js资源文件夹&gt;/loadBMap.js&#x27;</span><br></pre></td></tr></table></figure>

<p>第3步：在mounted中调用 loadBMap()</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//这里运用async/await 进行异步处理，保证BMap加载进来后才执行后面的操作</span><br><span class="line">async mounted() &#123;</span><br><span class="line">  await loadBMap(&#x27;您的密钥&#x27;) //加载引入BMap</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就在当前组件中引入百度地图 BMap 了，可以开始开发了。</p>
<h4 id="四、功能解析"><a href="#四、功能解析" class="headerlink" title="四、功能解析"></a>四、功能解析</h4><p>下面开始对上述所列 <strong>8</strong> 点功能进行详细的代码解析。<br>说明：本文用的是方法一引入百度地图，<a target="_blank" rel="noopener" href="https://github.com/Marco-hui/vue-admin-web">源码</a> 用的是方法二<br><strong>1、挂载百度地图</strong><br>首先需要给地图分配一个容器，并设置宽高</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div   style=&quot;100%;height:500px;&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>根据需求，定义data参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">data() &#123;</span><br><span class="line">  return &#123;</span><br><span class="line">    form: &#123;</span><br><span class="line">      address: &#x27;&#x27;, //详细地址</span><br><span class="line">      addrPoint: &#123; //详细地址经纬度</span><br><span class="line">        lng: 0,</span><br><span class="line">        lat: 0</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    map: &#x27;&#x27;, //地图实例</span><br><span class="line">    mk: &#x27;&#x27; //Marker实例</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>初始化地图</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  initMap() &#123;</span><br><span class="line">    var that = this;</span><br><span class="line">    this.map = new BMap.Map(&quot;map-container&quot;, &#123;enableMapClick:false&#125;)  //新建地图实例，enableMapClick:false ：禁用地图默认点击弹框</span><br><span class="line">    var point = new BMap.Point(113.30765,23.12005);</span><br><span class="line">    this.map.centerAndZoom(point,19)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">mounted() &#123;</span><br><span class="line">  this.initMap()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>到此，就可以在你的页面上看到地图啦！<br><strong>2、封装逆地址解析函数</strong><br>参考百度地图 <a target="_blank" rel="noopener" href="http://lbsyun.baidu.com/jsdemo.htm#i7_2">逆地址解析</a> 示例demo，封装一个逆地址解析函数，供下面的功能调用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 逆地址解析函数（根据坐标点获取详细地址）</span><br><span class="line"> * @param &#123;Object&#125; point   百度地图坐标点，必传</span><br><span class="line"> */</span><br><span class="line">getAddrByPoint(point)&#123;</span><br><span class="line">  var that = this;</span><br><span class="line">  var geco = new BMap.Geocoder();</span><br><span class="line">  geco.getLocation(point, function(res)&#123;</span><br><span class="line">  	console.log(res)  //内容见下图</span><br><span class="line">    that.mk.setPosition(point) //重新设置标注的地理坐标</span><br><span class="line">    that.map.panTo(point)  //将地图的中心点更改为给定的点</span><br><span class="line">    that.form.address = res.address;  //记录该点的详细地址信息</span><br><span class="line">    that.form.addrPoint = point;  //记录当前坐标点</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20191217142451620.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01hcmNvX2h1aQ==,size_16,color_FFFFFF,t_70" alt="逆地址解析获取的信息"><br><strong>3、设置图像标注并绑定拖拽标注结束后事件</strong><br>图像标注Marker是百度地图覆盖物类中的其中一种，它用来标识当前坐标点的位置，也就是我们在地图上所看到的小红点（当然这个点也可以自定义图标样式，这里我们不说，有兴趣的可以参考百度地图覆盖物示例 - <a target="_blank" rel="noopener" href="http://lbsyun.baidu.com/jsdemo.htm#c1_16">设置点的新图标</a>）。<br>设置图像标注很简单，只需要下面两行代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">initMap() &#123;</span><br><span class="line">  ...</span><br><span class="line">  this.mk = new BMap.Marker(point,&#123;enableDragging:true&#125;) //创建一个图像标注实例，enableDragging：是否启用拖拽，默认为false</span><br><span class="line">  this.map.addOverlay(this.mk) //将覆盖物添加到地图中</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样你就可以在地图上看到小红点啦，接下来我们给这个点绑定拖拽事件。<br>拖拽事件有三类，dragstart（开始拖拽时触发）、dragging（拖拽过程中触发）和dragend（拖拽结束时触发），实际项目中我们更注重的是拖拽标注结束后的位置信息，因此我们在这给标注绑定拖拽结束后事件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">initMap() &#123;</span><br><span class="line">  ...</span><br><span class="line">  this.mk.addEventListener(&#x27;dragend&#x27;, function(e)&#123;</span><br><span class="line">    that.getAddrByPoint(e.point) //拖拽结束后调用逆地址解析函数，e.point为拖拽后的地理坐标</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：这里我们将代码写在上面定义的 initMap 函数中，地图初始化时一同执行即可<br><strong>4、添加（右上角）平移缩放控件</strong><br>百度地图提供了很多的 <a target="_blank" rel="noopener" href="http://lbsyun.baidu.com/cms/jsapi/reference/jsapi_reference_3_0.html#a2b0">控件类</a>，方便我们查看和操作地图。本案例只解析平移缩放控件NavigationControl 和 地图定位控件GeolocationControl，其他控件可 <a target="_blank" rel="noopener" href="http://lbsyun.baidu.com/jsdemo.htm#b0_2">参考示例</a> 自行学习。<br>下面我们先引入平移缩放控件并将其位置置于右上角：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">initMap() &#123;</span><br><span class="line">  ...</span><br><span class="line">  var navigationControl = new BMap.NavigationControl(&#123; //创建一个特定样式的地图平移缩放控件</span><br><span class="line">    anchor: BMAP_ANCHOR_TOP_RIGHT, //靠右上角位置</span><br><span class="line">    type: BMAP_NAVIGATION_CONTROL_SMALL //SMALL控件类型</span><br><span class="line">  &#125;)</span><br><span class="line">  this.map.addControl(navigationControl ) //将控件添加到地图</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>附：</strong><br>anchor参数解析<br>BMAP_ANCHOR_TOP_LEFT | 控件将定位到地图的左上角<br>BMAP_ANCHOR_TOP_RIGHT | 控件将定位到地图的右上角<br>BMAP_ANCHOR_BOTTOM_LEFT | 控件将定位到地图的左下角<br>BMAP_ANCHOR_BOTTOM_RIGHT | 控件将定位到地图的右下角<br>type参数解析<br>BMAP_NAVIGATION_CONTROL_LARGE | 标准的平移缩放控件（包括平移、缩放按钮和滑块）<br>BMAP_NAVIGATION_CONTROL_SMALL | 仅包含平移和缩放按钮<br>BMAP_NAVIGATION_CONTROL_PAN | 仅包含平移按钮<br>BMAP_NAVIGATION_CONTROL_ZOOM | 仅包含缩放按钮<br><strong>5、添加（左下角）定位控件</strong><br>下面我们引入地图定位控件并将其位置置于左下角：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">initMap() &#123;</span><br><span class="line">  ...</span><br><span class="line">  var geolocationControl = new BMap.GeolocationControl(&#123;anchor: BMAP_ANCHOR_BOTTOM_LEFT&#125;) //创建一个地图定位控件</span><br><span class="line">  geolocationControl.addEventListener(&quot;locationSuccess&quot;, function(e)&#123; //绑定定位成功后事件</span><br><span class="line">    that.getAddrByPoint(e.point) //定位成功后调用逆地址解析函数</span><br><span class="line">  &#125;);</span><br><span class="line">  geolocationControl.addEventListener(&quot;locationError&quot;,function(e)&#123; //绑定定位失败后事件</span><br><span class="line">    alert(e.message);</span><br><span class="line">  &#125;);</span><br><span class="line">  this.map.addControl(geolocationControl) //将控件添加到地图</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>6、浏览器定位</strong><br>参考百度地图 <a target="_blank" rel="noopener" href="http://lbsyun.baidu.com/jsdemo.htm#i8_1">浏览器定位</a> 示例demo，进入页面，我们将坐标定位到当前所在地坐标。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 浏览器定位函数</span><br><span class="line"> */</span><br><span class="line">geolocation() &#123;</span><br><span class="line">  var that = this;</span><br><span class="line">  var geolocation = new BMap.Geolocation();</span><br><span class="line">  geolocation.getCurrentPosition(function(res)&#123;</span><br><span class="line">    if(this.getStatus() == BMAP_STATUS_SUCCESS)&#123;</span><br><span class="line">      that.getAddrByPoint(res.point) //当成功时，调用逆地址解析函数</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      alert(&#x27;failed&#x27;+this.getStatus()); //失败时，弹出失败状态码</span><br><span class="line">    &#125;        </span><br><span class="line">  &#125;,&#123;enableHighAccuracy: true&#125;) //enableHighAccuracy：是否要求浏览器获取最佳效果，默认为false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同样在initMap中调用即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">initMap() &#123;</span><br><span class="line">  ...</span><br><span class="line">  this.geolocation()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>7、绑定点击地图任意点事件</strong><br>在地图上选取地址。点击地图上任意点，都将获取该点的地址信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">initMap() &#123;</span><br><span class="line">  ...</span><br><span class="line">  this.map.addEventListener(&#x27;click&#x27;, function(e)&#123; //给地图绑定点击事件</span><br><span class="line">    that.getAddrByPoint(e.point) //点击后调用逆地址解析函数</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>8、结合element-ui实现输入提示选取地址并定位功能</strong><br>最后是本案例的主要功能，输入框输入关键字搜索地址，调用百度地图LocalSearch服务进行检索。<br>首先，我们需要写入一个输入框。这里利用的是element-ui的 <el-autocomplete>组件，该组件提供了fetch-suggestions属性和select事件【<a target="_blank" rel="noopener" href="https://element.eleme.cn/#/zh-CN/component/input#autocomplete-attributes">参考文档</a>】，方便我们把检索结果遍历显示出来并进行选择操作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-autocomplete</span><br><span class="line">   </span><br><span class="line">  popper- </span><br><span class="line">  v-model=&quot;form.address&quot;</span><br><span class="line">  :fetch-suggestions=&quot;querySearchAsync&quot;</span><br><span class="line">  :trigger-on-focus=&quot;false&quot;</span><br><span class="line">  placeholder=&quot;详细地址&quot;</span><br><span class="line">  @select=&quot;handleSelect&quot;</span><br><span class="line">  clearable&gt;</span><br><span class="line">  &lt;template slot-scope=&quot;&#123; item &#125;&quot;&gt;</span><br><span class="line">    &lt;i class=&quot;el-icon-search fl mgr10&quot;&gt;&lt;/i&gt;</span><br><span class="line">    &lt;div style=&quot;overflow:hidden;&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;title&quot;&gt;&#123;&#123; item.title &#125;&#125;&lt;/div&gt;</span><br><span class="line">      &lt;span class=&quot;address ellipsis&quot;&gt;&#123;&#123; item.address &#125;&#125;&lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/template&gt;</span><br><span class="line">&lt;/el-autocomplete&gt;</span><br></pre></td></tr></table></figure>

<p>接下来需提供两个方法：</p>
<ul>
<li>querySearchAsync：搜索建议方法（参考百度地图检索示例 - <a target="_blank" rel="noopener" href="http://lbsyun.baidu.com/jsdemo.htm#i1_4">本地检索的数据接口</a>）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">querySearchAsync(str,cb)&#123;</span><br><span class="line">  var options = &#123;</span><br><span class="line">    onSearchComplete: function(res)&#123; //检索完成后的回调函数</span><br><span class="line">      var s = [];</span><br><span class="line">      if (local.getStatus() == BMAP_STATUS_SUCCESS)&#123;</span><br><span class="line">        for (var i = 0; i &lt; res.getCurrentNumPois(); i ++)&#123;</span><br><span class="line">          s.push(res.getPoi(i));</span><br><span class="line">        &#125;</span><br><span class="line">        cb(s) //获取到数据时，通过回调函数cb返回到&lt;el-autocomplete&gt;组件中进行显示</span><br><span class="line">      &#125; else&#123;</span><br><span class="line">        cb(s)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  var local = new BMap.LocalSearch(this.map, options) //创建LocalSearch构造函数</span><br><span class="line">  local.search(str) //调用search方法，根据检索词str发起检索</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>handleSelect：点击选中建议项时触发的方法</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">handleSelect(item) &#123;</span><br><span class="line">  this.form.address = item.address + item.title; //记录详细地址，含建筑物名</span><br><span class="line">  this.form.addrPoint = item.point; //记录当前选中地址坐标</span><br><span class="line">  this.map.clearOverlays() //清除地图上所有覆盖物</span><br><span class="line">  this.mk = new BMap.Marker(item.point) //根据所选坐标重新创建Marker</span><br><span class="line">  this.map.addOverlay(this.mk) //将覆盖物重新添加到地图中</span><br><span class="line">  this.map.panTo(item.point) //将地图的中心点更改为选定坐标点</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后再稍微处理一下autocomplete组件的下拉款样式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.autoAddressClass&#123;</span><br><span class="line">  li &#123;</span><br><span class="line">    i.el-icon-search &#123;margin-top:11px;&#125;</span><br><span class="line">    .mgr10 &#123;margin-right: 10px;&#125;</span><br><span class="line">    .title &#123;</span><br><span class="line">      text-overflow: ellipsis;</span><br><span class="line">      overflow: hidden;</span><br><span class="line">    &#125;</span><br><span class="line">    .address &#123;</span><br><span class="line">      line-height: 1;</span><br><span class="line">      font-size: 12px;</span><br><span class="line">      color: #b4b4b4;</span><br><span class="line">      margin-bottom: 5px;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至此，我们就完成了上面所有的功能点。</p>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="m-pagination col-md-8 col-md-offset-2 col-sm-24" role="pagination">
    
    
    <a class="pull-right" href="/2023/07/05/js-stu/">
        ES6中js的运算符（?.、?:、? ?、? ?=、） →
    </a>
    
</nav>

        <div class="col-md-8 col-md-offset-2 col-sm-24"><script type="text/javascript">
  /**
   * 搜狐畅言
   */

  /*
  document.write('<div id="SOHUCS" sid="' + window.location.pathname.slice(1) + '" ></div>');

  window.onload = function () {
    (function () {
      var appid = 'cytXXXX';
      var conf = 'prod_xxxxxxxxxxxxxxxxx';
      var width = window.innerWidth || document.documentElement.clientWidth;
      var loadJs = function (d, a, id) {
        var c = document.getElementsByTagName("head")[0] || document.head || document.documentElement;
        var b = document.createElement("script");
        b.setAttribute("type", "text/javascript");
        b.setAttribute("charset", "UTF-8");
        b.setAttribute("src", d);
        if (id) {
          b.setAttribute("id", id);
        }
        if (typeof a === "function") {
          if (window.attachEvent) {
            b.onreadystatechange = function () {
              var e = b.readyState;
              if (e === "loaded" || e === "complete") {
                b.onreadystatechange = null;
                a()
              }
            }
          } else {
            b.onload = a
          }
        }
        c.appendChild(b)
      };

      loadJs("https://changyan.sohu.com/upload/changyan.js", function () {
        window.changyan.api.config({
          appid: appid,
          conf: conf
        })
      });
    })();
  }
  */

</script>
</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By SQD. All Rights Reserved.
                </p>
                <p>Theme By <a target="_blank" rel="noopener" href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a>&nbsp;</li>
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };

    resizeHero();

    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$('#intro').find('img').each(function(){
  var alt = this.alt;

  if (alt){
    $(this).after('<span class="caption" style="display:none">' + alt + '</span>');
  }

  $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="gallery" />');
});
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



      
</body>
</html>
